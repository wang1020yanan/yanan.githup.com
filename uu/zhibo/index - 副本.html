<!DOCTYPE html>
<html>
<head>
	<title></title>
	<script type="text/javascript" src="js/jquery.min.js"></script>
	<script type="text/javascript" src="jwplayer.js"></script>
	<script type="text/javascript" src="jwplayer.html5.js"></script>
</head>
<body>
<div id="container">Loading the player ...</div>
<script type="text/javascript">

	var player = null;
	function get_user_num() {
		$.ajax( {
			url:'/s/?act=get_user_num',
			data:{
				live_id: $('#live_id').val()
			},
			type:'post',
			cache:false,
			dataType:'json',
			success:function(data) {
				if (typeof data.total != 'undefined') {
					$('#user_num').html(data.total);
				}
			},
			error : function() {

			}
		});
	}
	function getWidth(){
		return 360;
	};
	function getHeight() {
		return 640;
	};
	var media_info={};
	media_info.status=1;
	function play() {

		if (media_info.status == 1) {

			player = jwplayer("container").setup({
				flashplayer: 'jwplayer.flash.swf',
				id: 'playerID',
				width: getWidth(),
				height: getHeight(),
				file:"rtmp://pull.a8.com/live/146234107041542",
//				skin: "/Public/jwplayer/jwplayer-skins-premium/vapor.xml",
//				file: media_info.file[0],
				image: media_info.image,
				primary: "flash",
				controls: false,
				events: {
					onComplete: onComplete,
					onReady: function () {
						$('#play-control').show();
						$('#media_status_msg').html('直播中，点击观看');
						set_pos();
					},
					onPlay: onPlay,
					onPause: onPause,
					onBuffer: onBuffer,
					onDisplayClick: onDisplayClick,
					onSetupError: onSetupError,
					onBufferChange: function () { console.log("onBufferChange!!!"); },
					onBufferFull: function () { console.log("onBufferFull!!!"); }
				}

			});
		}else{

			var playlist = [];
			for(var i = 0; i < media_info.file.length; i++) {
				playlist.push({file: media_info.file[i], image: media_info.image});
			}
			player = jwplayer("container").setup({
				flashplayer: 'jwplayer.flash.swf',
				file: 'www.mp4',
				id: 'playerID',
				width: '368',
				height: '640',
				skin: "/Public/jwplayer/jwplayer-skins-premium/bekle.xml?t="+Math.random(),
				playlist: playlist,
				primary: "flash",
				controls: true,
				events: {
					onComplete: onComplete,
					onReady: function () {
						//$('#media_status_msg').html('24小时保鲜期已过<br>下载映客观看TA的更多直播吧');
						set_pos();
					},
					onPlay: onPlay,
					onPause: onPause,
					onBuffer: onBuffer,
					onDisplayClick: onDisplayClick,
					onSetupError: onSetupError,
					onBufferChange: function () { console.log("onBufferChange!!!"); },
					onBufferFull: function () { console.log("onBufferFull!!!"); }
				}

			});
		}
//		get_user_num();
	}
	function onComplete() {
		//alert('播放完毕');
	}
	function onBuffer() {
		$('#media_status_msg').hide();

		if (media_info.status == 1) {
			$('#play-control').show();
			$('#play-control').attr('class', 'btn loading pa');
		}
		console.log('onBuffer');
	}
	function onPlay() {
		$('#media_status_msg').hide();
		if (media_info.status == 1) {
			$('#play-control').hide();
			$('#play-control').attr('class', 'btn play pa');
		}
	}
	function onPause() {
		$('#media_status_msg').hide();

		if (media_info.status == 1) {
			$('#play-control').show();
			$('#play-control').attr('class', 'btn play pa');
		}
		playing = false;
		console.log('onPause');
	}
	function onDisplayClick() {
		player.pause();
	}
	function onSetupError(a, b) {
		if (media_info.status == 1) {
			$('#play-control').hide();
		}

		if ((media_info.forbid == 1 && media_info.reason != '') || media_info.shieldstat === false) {
			$('#media_status_msg').html('<p style="text-align:center;color:#ffffff;">'+media_info.reason+'</p>');
			$('#media_status_msg').show();
		}
	}
	function user_show() {

		if (trim($('#nick').html()) == '') {
			$('.user').hide();
		}else{
			$('.user').show();
		}
	}
	function set_pos() {
		var play_left = $('#container_wrapper').offset().left;
		$('.user').css('left', 145);
		$('.num').css('left', 145 + getWidth() - 50);
		user_show();
		if (media_info.status == 1) {
			$('.num').show();
		}else{
			$('.num').hide();
		}
		//$('.num').show();
		//$('.user').show();
	}
	function resize() {
		set_pos();
	}

	var playing = false;

	$(document).ready(function(){
		if ((media_info.forbid == 1 && media_info.reason != '') || media_info.shieldstat === false) {
			$('#media_status_msg').html('<p style="text-align:center;color:#000;">'+media_info.reason+'</p>');
			$('#media_status_msg').show();
		}else{
			play();
			$('#play-control').click(function() {
				player.play();
			});
		}

	});


</script>
</body>
</html>